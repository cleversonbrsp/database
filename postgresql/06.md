Vamos avan√ßar para o **N√≠vel 6: Functions, Procedures e L√≥gica no PostgreSQL** ‚öîÔ∏èüß†  
Aqui voc√™ vai aprender a transformar o PostgreSQL em uma m√°quina de regras e l√≥gica, com blocos que lembram programa√ß√£o de verdade!

---

## ‚öôÔ∏è **N√≠vel 6 ‚Äì Fun√ß√µes, Procedures e Controle de Fluxo**

### üß† **Conceito simples:**
Pense em **Functions** como **habilidades** que o guerreiro pode usar v√°rias vezes, e **Procedures** como **rituais complexos** que alteram o mundo (a base de dados).

- **Function**: retorna um valor, pode ser usada dentro de queries.
- **Procedure**: executa a√ß√µes, pode fazer commits, loops, etc.

---

## ‚úÖ **Parte 1 ‚Äì Fun√ß√µes simples**

### Exemplo: retornar a m√©dia de n√≠vel dos guerreiros

```sql
CREATE FUNCTION media_nivel_guerreiros()
RETURNS NUMERIC AS $$
BEGIN
  RETURN (SELECT AVG(nivel) FROM guerreiros);
END;
$$ LANGUAGE plpgsql;
```

Use assim:
```sql
SELECT media_nivel_guerreiros();
```

---

## üîÅ **Parte 2 ‚Äì Fun√ß√µes com par√¢metros**

```sql
CREATE FUNCTION guerreiros_por_cidade(cidade_nome TEXT)
RETURNS TABLE(nome TEXT, nivel INTEGER) AS $$
BEGIN
  RETURN QUERY
  SELECT g.nome, g.nivel
  FROM guerreiros g
  JOIN moradias m ON g.id = m.guerreiro_id
  JOIN cidades c ON c.id = m.cidade_id
  WHERE c.nome = cidade_nome;
END;
$$ LANGUAGE plpgsql;
```

Chamada:
```sql
SELECT * FROM guerreiros_por_cidade('Heli√≥polis');
```

---

## üåÄ **Parte 3 ‚Äì Procedure com l√≥gica e loop**

```sql
CREATE PROCEDURE aumentar_nivel_guerreiros(incremento INTEGER)
LANGUAGE plpgsql
AS $$
BEGIN
  UPDATE guerreiros
  SET nivel = nivel + incremento;
END;
$$;
```

Chamada:
```sql
CALL aumentar_nivel_guerreiros(2);
```

---

## üß™ **Desafio N√≠vel 6 ‚Äì Os Rituais da Tabela**

1. Crie uma fun√ß√£o `nivel_medio_classe(classe_guerreiro)` que retorna a m√©dia de n√≠vel por classe.
2. Crie uma fun√ß√£o `guerreiros_com_habilidade(hab TEXT)` que retorna nome e habilidades de guerreiros que tenham aquela habilidade no array.
3. Crie uma procedure `resetar_historico()` que zera o campo `historico` de todos os guerreiros.